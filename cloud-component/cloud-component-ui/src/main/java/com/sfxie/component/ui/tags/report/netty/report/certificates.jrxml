<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="2016ylmsl" pageWidth="1850" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="1850" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isIgnorePagination="true" uuid="fafbb383-9d14-484c-a56a-ab61a95018b1">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="737"/>
	<property name="ireport.y" value="0"/>
	<style name="table_TH" mode="Opaque" backcolor="#B0B0B0">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="table_TD" mode="Opaque">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<parameter name="mmCode" class="java.lang.String"/>
	<parameter name="isOuter" class="java.lang.String"/>
	<parameter name="certificationMap" class="java.lang.Object"/>
	<queryString>
		<![CDATA[SELECT s.* from(
SELECT t.* ,CONCAT(
  if (s.certificateId is not null,'身份证号码重复;',''), t.errorTag) errorTag2
FROM (
SELECT t.*,d.`value` certificateText,CONCAT(
  if (LENGTH( t.mainMobile) < 11  or LENGTH( t.mainMobile) > 12,'手机号码位数问题;',''),
  if(LENGTH( t.certificateId) <> 18 and t.certificateType = 1,'身份证号码位数问题;',''),
  if((REPLACE(REPLACE(trim(t.certificateId),'X',''),'x','')  REGEXP '[^0-9]')  and t.certificateType = 1,'身份证号码有误','')
) errorTag
 FROM vankecrm_center.data_export_certificateid_mch t
INNER JOIN (
	SELECT
	di.`value`,
  di.`code`
	FROM
		dim_dictionary dd ,
		dim_dictionary_items di
	WHERE
	dd.tableName = 'main_customer'
	AND dd.fieldName = 'certificateType'
	AND di.dictionaryId = dd.id
)d ON d.`code` = t.certificateType
WHERE t.manageCode = $P{mmCode} and t.isOuter = $P{isOuter}
GROUP BY t.manageName,t.certificateId,t.fullName,t.mainMobile
ORDER BY t.certificateId desc,t.fullName asc,t.mainMobile desc
)
t LEFT JOIN (
	SELECT t.certificateId from(
	SELECT DISTINCT t.manageName,t.certificateId,t.fullName,t.mainMobile FROM vankecrm_center.data_export_certificateid_mch t
	WHERE t.manageCode = $P{mmCode} AND t.certificateId <> ''  AND t.certificateType = 1
	GROUP BY t.manageName,t.certificateId,t.fullName,t.mainMobile
	ORDER BY t.certificateId

	) t
	GROUP BY t.certificateId   HAVING count(1) > 1
) s
 on t.certificateId = s.certificateId
)
s WHERE s.errorTag2 <> ''
;]]>
	</queryString>
	<field name="id" class="java.lang.Long">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="mchId" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="manageCode" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="manageName" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="projectId" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="projectCode" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="isOuter" class="java.lang.Boolean">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="projectName" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="houseId" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="houseCode" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="houseName" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="customerId" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fullName" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="certificateId" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="mainMobile" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="certificateType" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="createTime" class="java.sql.Timestamp">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="certificateText" class="java.lang.String"/>
	<field name="errorTag2" class="java.lang.String"/>
	<pageHeader>
		<band height="50">
			<staticText>
				<reportElement mode="Opaque" x="0" y="0" width="1850" height="50" forecolor="#000000" backcolor="#E1FFCC" uuid="7e777ad0-d8c9-451b-a479-224c5317b3df"/>
				<textElement verticalAlignment="Middle">
					<font size="11"/>
				</textElement>
				<text><![CDATA[数据修改反馈说明：
1、对于“身份证号码位数问题”、“手机号码位数问题”的问题类型，需与客户联系取得正确的客户信息，在CRM系统中进行修改，并在K列反馈是/否修改，未修改的在L列注明未修改原因；
2、对于“身份证号码重复”的问题类型，判断需要保留或删除的客户信息，并在此表M列选择保留/删除（注意：重复信息中必须保留一条正确信息，不能选择全部删除）。]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="20">
			<staticText>
				<reportElement style="table_TH" x="350" y="0" width="100" height="20" uuid="d2e59684-3b1a-47a1-baff-aba7e908bb5b"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[证件号码 ]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="50" y="0" width="100" height="20" uuid="05fa595a-0f94-44ac-bef7-41dbf0624abe"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[管理中心]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="150" y="0" width="100" height="20" uuid="1535630c-d262-4957-b7dc-0896b578591c"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[项目名称]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="250" y="0" width="100" height="20" uuid="d563e9b0-3778-4964-b2b2-a64e7c4d449e"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[房屋名称]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="450" y="0" width="100" height="20" uuid="59ae4b5b-5994-4840-a77c-ba6e8655d048"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[证件类型]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="550" y="0" width="100" height="20" uuid="b7c86c6f-ccbe-4d37-be8b-afd77c62176b"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[客户姓名]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="650" y="0" width="100" height="20" uuid="395c280f-de29-49ce-8ce0-3e1fbc1663cc"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[手机号码]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="750" y="0" width="100" height="20" uuid="4bf15634-b141-46bd-bc36-f03c28080bb1"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[客户ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1500" y="0" width="100" height="20" backcolor="#33CC00" uuid="e7adeeb6-a6d3-4039-a213-8fd2b704c714"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[房屋编码]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="850" y="0" width="200" height="20" backcolor="#33CC00" uuid="77fe96bc-d925-4f11-a2fc-d29d6cc2595c"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[问题类型]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="0" y="0" width="50" height="20" uuid="a9fcdb22-6ea1-473e-bdd8-bf76d5287c2a"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[序号]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1600" y="0" width="100" height="20" backcolor="#33CC00" uuid="32cd1e33-e7f4-46d6-8fce-0dd4d46802e3"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[客房关系ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1700" y="0" width="100" height="20" backcolor="#33CC00" uuid="f4ed8f0b-74d7-4eca-93e0-32338b4a0d84"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[ID]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1400" y="0" width="100" height="20" backcolor="#33CC00" uuid="964279b7-d98a-4dc0-988a-23ad8fab2851"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[项目编码]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1800" y="0" width="50" height="20" backcolor="#33CC00" uuid="3655eb52-e7a6-4b51-a037-50a8e5a3326e"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[isOuter]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1275" y="0" width="125" height="20" backcolor="#FFFFCC" uuid="dc545fe3-60db-4ea9-978e-21863b07220f"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[是否删除]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1050" y="0" width="125" height="20" backcolor="#FFFFCC" uuid="3173e580-a3d7-47b4-a95f-98c81d1e77a3"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[是否修改]]></text>
			</staticText>
			<staticText>
				<reportElement style="table_TH" x="1175" y="0" width="100" height="20" backcolor="#FFFFCC" uuid="55e8a396-2d88-4b63-804f-87598d543494"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<text><![CDATA[未修改原因]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="450" y="0" width="100" height="20" uuid="091036b0-9574-442a-9005-acb012a20f67"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{certificateText}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="350" y="0" width="100" height="20" uuid="d5dc1caa-34dc-452f-b93a-4fe4c4f89b3d"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{certificateId}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="50" y="0" width="100" height="20" uuid="a2d9b9d4-8f71-4447-9e2c-a2f1d22d79b1"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{manageName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="150" y="0" width="100" height="20" uuid="2c83bdf6-4a7f-4cb1-b6bb-7b8b36d3ced7"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{projectName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="250" y="0" width="100" height="20" uuid="1b5b2550-70a3-4e26-bfe2-10c9b39254a4"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{houseName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="550" y="0" width="100" height="20" uuid="e38b37c0-dbc7-4612-9a37-5f59146bf3c8"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{fullName}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="750" y="0" width="100" height="20" uuid="6fcb4509-e4f3-4ec2-b131-160830a90a0d"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{customerId}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="650" y="0" width="100" height="20" uuid="9efc1182-77eb-428e-b7e9-46ddc40fc8ea"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{mainMobile}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1500" y="0" width="100" height="20" uuid="866cb2a9-a3e8-4e07-a0b8-78cddffe7881"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{houseCode}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="850" y="0" width="200" height="20" uuid="4032c85d-194a-4d9e-a688-bf04634a05dd"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{errorTag2}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="0" y="0" width="50" height="20" uuid="3d54bdf7-bbcb-49a4-b092-3621de43eaba"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{COLUMN_COUNT}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1600" y="0" width="100" height="20" uuid="187df610-61b0-4a6b-809a-aeaa9ab03d1c"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{mchId}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1700" y="0" width="100" height="20" uuid="34c5401d-5f11-402d-8e2a-ffdfda30f298"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1400" y="0" width="100" height="20" uuid="6732921d-d7cd-41c6-8051-6dfc2d3585ac"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{projectCode}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1800" y="0" width="50" height="20" uuid="374ca94a-e888-4216-8b99-9588c3d20fd8"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$F{isOuter}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1050" y="0" width="125" height="20" uuid="155b9838-9cf0-401e-90dc-c1030a046c49"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[""]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1275" y="0" width="125" height="20" uuid="bb30b631-41c9-4f0c-97dc-bb8bc4a08abc"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[""]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement style="table_TD" stretchType="RelativeToBandHeight" x="1175" y="0" width="100" height="20" uuid="f4232609-62af-40e9-98a5-1a6dad09c9f6"/>
				<textElement verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[""]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
